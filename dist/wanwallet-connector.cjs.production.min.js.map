{"version":3,"file":"wanwallet-connector.cjs.production.min.js","sources":["../src/index.ts"],"sourcesContent":["import { ConnectorUpdate } from '@web3-react-wan/types'\r\nimport { AbstractConnector } from '@web3-react-wan/abstract-connector'\r\nimport Web3ProviderEngine from 'web3-provider-engine'\r\nimport { WanWalletSubprovider } from '@wanswap/subproviders/lib/src/subproviders/wanwallet' // https://github.com/0xProject/0x-monorepo/issues/1400\r\nimport CacheSubprovider from 'web3-provider-engine/subproviders/cache.js'\r\nimport { RPCSubprovider } from '@0x/subproviders/lib/src/subproviders/rpc_subprovider' // https://github.com/0xProject/0x-monorepo/issues/1400\r\n\r\ninterface WanWalletConnectorArguments {\r\n  chainId: number\r\n  url: string\r\n  pollingInterval?: number\r\n  requestTimeoutMs?: number\r\n}\r\n\r\nexport class WanWalletConnector extends AbstractConnector {\r\n  private readonly chainId: number\r\n  private readonly url: string\r\n  private readonly pollingInterval?: number\r\n  private readonly requestTimeoutMs?: number\r\n\r\n  private provider: any\r\n\r\n  constructor({\r\n    chainId,\r\n    url,\r\n    pollingInterval,\r\n    requestTimeoutMs,\r\n  }: WanWalletConnectorArguments) {\r\n    super({ supportedChainIds: [chainId] })\r\n\r\n    this.chainId = chainId\r\n    this.url = url\r\n    this.pollingInterval = pollingInterval\r\n    this.requestTimeoutMs = requestTimeoutMs\r\n  }\r\n\r\n  public async activate(): Promise<ConnectorUpdate> {\r\n    if (!this.provider) {\r\n      const engine = new Web3ProviderEngine({ pollingInterval: this.pollingInterval })\r\n      engine.addProvider(new WanWalletSubprovider())\r\n      engine.addProvider(new CacheSubprovider())\r\n      engine.addProvider(new RPCSubprovider(this.url, this.requestTimeoutMs))\r\n      this.provider = engine\r\n    }\r\n\r\n    this.provider.on('disconnect', this.handleDisconnect)\r\n\r\n    this.provider.start()\r\n\r\n    return { provider: this.provider, chainId: this.chainId }\r\n  }\r\n\r\n  private handleDisconnect(): void {\r\n    this.emitDeactivate()\r\n  }\r\n\r\n  public async getProvider(): Promise<Web3ProviderEngine> {\r\n    return this.provider\r\n  }\r\n\r\n  public async getChainId(): Promise<number | string> {\r\n    // return this.chainId\r\n    return new Promise((resolve, reject) => {\r\n      window.web3.eth.getChainId((err: string, chainId: number) => {\r\n        if (err) {\r\n          reject(err);\r\n        } else {\r\n          resolve(chainId);\r\n        }\r\n      });\r\n    })\r\n  }\r\n\r\n  public async getAccount(): Promise<null> {\r\n    return this.provider._providers[0].getAccountsAsync(1).then((accounts: string[]): string => accounts[0])\r\n  }\r\n\r\n  public deactivate() {\r\n    this.provider.stop()\r\n  }\r\n\r\n  public async close() {\r\n    this.provider.stop()\r\n    this.emitDeactivate()\r\n  }\r\n}\r\n"],"names":["_AbstractConnector","WanWalletConnector","_ref","chainId","url","pollingInterval","requestTimeoutMs","_this","call","supportedChainIds","_proto","prototype","activate","_activate","_asyncToGenerator","_regeneratorRuntime","mark","_callee","engine","wrap","_context","prev","next","this","provider","Web3ProviderEngine","addProvider","WanWalletSubprovider","CacheSubprovider","RPCSubprovider","on","handleDisconnect","start","abrupt","stop","apply","arguments","emitDeactivate","getProvider","_getProvider","_callee2","_context2","getChainId","_getChainId","_callee3","_context3","Promise","resolve","reject","window","web3","eth","err","getAccount","_getAccount","_callee4","_context4","_providers","getAccountsAsync","then","accounts","deactivate","close","_close","_callee5","_context5","AbstractConnector"],"mappings":"uuOAcgCA,WAQ9B,SAAAC,EAAAC,SACEC,EAAOD,EAAPC,QACAC,EAAGF,EAAHE,IACAC,EAAeH,EAAfG,gBACAC,EAAgBJ,EAAhBI,iBAOwC,OALxCC,EAAAP,EAAAQ,UAAM,CAAEC,kBAAmB,CAACN,YAEvBA,QAAUA,EACfI,EAAKH,IAAMA,EACXG,EAAKF,gBAAkBA,EACvBE,EAAKD,iBAAmBA,EAAgBC,IAnBZP,KAAAC,yEAoB7B,IAAAS,EAAAT,EAAAU,UAkDA,OAlDAD,EAEYE,oBAAQ,IAAAC,EAAAC,EAAAC,IAAAC,MAAd,SAAAC,IAAA,IAAAC,EAAA,OAAAH,IAAAI,eAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OAWgB,OAVhBC,KAAKC,YACFN,EAAS,IAAIO,EAAmB,CAAEpB,gBAAiBkB,KAAKlB,mBACvDqB,YAAY,IAAIC,wBACvBT,EAAOQ,YAAY,IAAIE,GACvBV,EAAOQ,YAAY,IAAIG,iBAAeN,KAAKnB,IAAKmB,KAAKjB,mBACrDiB,KAAKC,SAAWN,GAGlBK,KAAKC,SAASM,GAAG,aAAcP,KAAKQ,kBAEpCR,KAAKC,SAASQ,QAAOZ,EAAAa,gBAEd,CAAET,SAAUD,KAAKC,SAAUrB,QAASoB,KAAKpB,UAAS,OAAA,UAAA,OAAAiB,EAAAc,UAAAjB,YAC1D,OAAA,WAAA,OAAAJ,EAAAsB,WAAAC,eAAA1B,EAEOqB,iBAAA,WACNR,KAAKc,kBACN3B,EAEY4B,uBAAW,IAAAC,EAAAzB,EAAAC,IAAAC,MAAjB,SAAAwB,IAAA,OAAAzB,IAAAI,eAAAsB,GAAA,cAAAA,EAAApB,KAAAoB,EAAAnB,MAAA,OAAA,OAAAmB,EAAAR,gBACEV,KAAKC,UAAQ,OAAA,UAAA,OAAAiB,EAAAP,UAAAM,YACrB,OAAA,WAAA,OAAAD,EAAAJ,WAAAC,eAAA1B,EAEYgC,sBAAU,IAAAC,EAAA7B,EAAAC,IAAAC,MAAhB,SAAA4B,IAAA,OAAA7B,IAAAI,eAAA0B,GAAA,cAAAA,EAAAxB,KAAAwB,EAAAvB,MAAA,OAAA,OAAAuB,EAAAZ,gBAEE,IAAIa,SAAQ,SAACC,EAASC,GAC3BC,OAAOC,KAAKC,IAAIT,YAAW,SAACU,EAAajD,GACnCiD,EACFJ,EAAOI,GAEPL,EAAQ5C,UAGZ,OAAA,UAAA,OAAA0C,EAAAX,UAAAU,OACH,OAAA,WAAA,OAAAD,EAAAR,WAAAC,eAAA1B,EAEY2C,sBAAU,IAAAC,EAAAxC,EAAAC,IAAAC,MAAhB,SAAAuC,IAAA,OAAAxC,IAAAI,eAAAqC,GAAA,cAAAA,EAAAnC,KAAAmC,EAAAlC,MAAA,OAAA,OAAAkC,EAAAvB,gBACEV,KAAKC,SAASiC,WAAW,GAAGC,iBAAiB,GAAGC,MAAK,SAACC,GAAkB,OAAaA,EAAS,OAAG,OAAA,UAAA,OAAAJ,EAAAtB,UAAAqB,YACzG,OAAA,WAAA,OAAAD,EAAAnB,WAAAC,eAAA1B,EAEMmD,WAAA,WACLtC,KAAKC,SAASU,QACfxB,EAEYoD,iBAAK,IAAAC,EAAAjD,EAAAC,IAAAC,MAAX,SAAAgD,IAAA,OAAAjD,IAAAI,eAAA8C,GAAA,cAAAA,EAAA5C,KAAA4C,EAAA3C,MAAA,OACLC,KAAKC,SAASU,OACdX,KAAKc,iBAAgB,OAAA,UAAA,OAAA4B,EAAA/B,UAAA8B,YACtB,OAAA,WAAA,OAAAD,EAAA5B,WAAAC,eAAAnC,GAtEqCiE"}