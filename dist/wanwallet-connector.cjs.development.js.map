{"version":3,"file":"wanwallet-connector.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["import { ConnectorUpdate } from '@web3-react-wan/types'\nimport { AbstractConnector } from '@web3-react-wan/abstract-connector'\nimport Web3ProviderEngine from 'web3-provider-engine'\nimport { WanWalletSubprovider } from '@wanswap/subproviders/lib/src/subproviders/wanwallet' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport CacheSubprovider from 'web3-provider-engine/subproviders/cache.js'\nimport { RPCSubprovider } from '@0x/subproviders/lib/src/subproviders/rpc_subprovider' // https://github.com/0xProject/0x-monorepo/issues/1400\n\ninterface WanWalletConnectorArguments {\n  chainId: number\n  url: string\n  pollingInterval?: number\n  requestTimeoutMs?: number\n}\n\nexport class WanWalletConnector extends AbstractConnector {\n  private readonly chainId: number\n  private readonly url: string\n  private readonly pollingInterval?: number\n  private readonly requestTimeoutMs?: number\n\n  private provider: any\n\n  constructor({\n    chainId,\n    url,\n    pollingInterval,\n    requestTimeoutMs,\n  }: WanWalletConnectorArguments) {\n    super({ supportedChainIds: [chainId] })\n\n    this.chainId = chainId\n    this.url = url\n    this.pollingInterval = pollingInterval\n    this.requestTimeoutMs = requestTimeoutMs\n  }\n\n  public async activate(): Promise<ConnectorUpdate> {\n    if (!this.provider) {\n      const engine = new Web3ProviderEngine({ pollingInterval: this.pollingInterval })\n      engine.addProvider(new WanWalletSubprovider())\n      engine.addProvider(new CacheSubprovider())\n      engine.addProvider(new RPCSubprovider(this.url, this.requestTimeoutMs))\n      this.provider = engine\n    }\n\n    this.provider.on('disconnect', this.handleDisconnect)\n\n    this.provider.start()\n\n    return { provider: this.provider, chainId: this.chainId }\n  }\n\n  private handleDisconnect(): void {\n    this.deactivate()\n  }\n\n  public async getProvider(): Promise<Web3ProviderEngine> {\n    return this.provider\n  }\n\n  public async getChainId(): Promise<number> {\n    return this.chainId\n  }\n\n  public async getAccount(): Promise<null> {\n    return this.provider._providers[0].getAccountsAsync(1).then((accounts: string[]): string => accounts[0])\n  }\n\n  public deactivate() {\n    this.provider.stop()\n  }\n\n  public async close() {\n    this.provider.stop()\n    this.deactivate()\n  }\n}\n"],"names":["WanWalletConnector","chainId","url","pollingInterval","requestTimeoutMs","supportedChainIds","activate","provider","engine","Web3ProviderEngine","addProvider","WanWalletSubprovider","CacheSubprovider","RPCSubprovider","on","handleDisconnect","start","deactivate","getProvider","getChainId","getAccount","_providers","getAccountsAsync","then","accounts","stop","close","AbstractConnector"],"mappings":"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"}