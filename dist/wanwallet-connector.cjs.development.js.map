{"version":3,"file":"wanwallet-connector.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["import { ConnectorUpdate } from '@web3-react-wan/types'\r\nimport { AbstractConnector } from '@web3-react-wan/abstract-connector'\r\nimport Web3ProviderEngine from 'web3-provider-engine'\r\nimport { WanWalletSubprovider } from '@wanswap/subproviders/lib/src/subproviders/wanwallet' // https://github.com/0xProject/0x-monorepo/issues/1400\r\nimport CacheSubprovider from 'web3-provider-engine/subproviders/cache.js'\r\nimport { RPCSubprovider } from '@0x/subproviders/lib/src/subproviders/rpc_subprovider' // https://github.com/0xProject/0x-monorepo/issues/1400\r\n\r\ninterface WanWalletConnectorArguments {\r\n  chainId: number\r\n  url: string\r\n  pollingInterval?: number\r\n  requestTimeoutMs?: number\r\n}\r\n\r\nexport class WanWalletConnector extends AbstractConnector {\r\n  private readonly chainId: number\r\n  private readonly url: string\r\n  private readonly pollingInterval?: number\r\n  private readonly requestTimeoutMs?: number\r\n\r\n  private provider: any\r\n\r\n  constructor({\r\n    chainId,\r\n    url,\r\n    pollingInterval,\r\n    requestTimeoutMs,\r\n  }: WanWalletConnectorArguments) {\r\n    super({ supportedChainIds: [chainId] })\r\n\r\n    this.chainId = chainId\r\n    this.url = url\r\n    this.pollingInterval = pollingInterval\r\n    this.requestTimeoutMs = requestTimeoutMs\r\n  }\r\n\r\n  public async activate(): Promise<ConnectorUpdate> {\r\n    if (!this.provider) {\r\n      const engine = new Web3ProviderEngine({ pollingInterval: this.pollingInterval })\r\n      engine.addProvider(new WanWalletSubprovider())\r\n      engine.addProvider(new CacheSubprovider())\r\n      engine.addProvider(new RPCSubprovider(this.url, this.requestTimeoutMs))\r\n      this.provider = engine\r\n    }\r\n\r\n    this.provider.on('disconnect', this.handleDisconnect)\r\n\r\n    this.provider.start()\r\n\r\n    return { provider: this.provider, chainId: this.chainId }\r\n  }\r\n\r\n  private handleDisconnect(): void {\r\n    this.emitDeactivate()\r\n  }\r\n\r\n  public async getProvider(): Promise<Web3ProviderEngine> {\r\n    return this.provider\r\n  }\r\n\r\n  public async getChainId(): Promise<number | string> {\r\n    // return this.chainId\r\n    return new Promise((resolve, reject) => {\r\n      window.web3.eth.getChainId((err: string, chainId: number) => {\r\n        if (err) {\r\n          reject(err);\r\n        } else {\r\n          resolve(chainId);\r\n        }\r\n      });\r\n    })\r\n  }\r\n\r\n  public async getAccount(): Promise<null> {\r\n    return this.provider._providers[0].getAccountsAsync(1).then((accounts: string[]): string => accounts[0])\r\n  }\r\n\r\n  public deactivate() {\r\n    this.provider.stop()\r\n  }\r\n\r\n  public async close() {\r\n    this.provider.stop()\r\n    this.emitDeactivate()\r\n  }\r\n}\r\n"],"names":["WanWalletConnector","_AbstractConnector","_inheritsLoose","_ref","chainId","url","pollingInterval","requestTimeoutMs","_this","call","supportedChainIds","_proto","prototype","activate","_activate","_asyncToGenerator","_regeneratorRuntime","mark","_callee","engine","wrap","_callee$","_context","prev","next","provider","Web3ProviderEngine","addProvider","WanWalletSubprovider","CacheSubprovider","RPCSubprovider","on","handleDisconnect","start","abrupt","stop","apply","arguments","emitDeactivate","getProvider","_getProvider","_callee2","_callee2$","_context2","getChainId","_getChainId","_callee3","_callee3$","_context3","Promise","resolve","reject","window","web3","eth","err","getAccount","_getAccount","_callee4","_callee4$","_context4","_providers","getAccountsAsync","then","accounts","deactivate","close","_close","_callee5","_callee5$","_context5","AbstractConnector"],"mappings":"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"}